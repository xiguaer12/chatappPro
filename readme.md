# ğŸ“¨ Lightweight Java Web Chat Application

ä¸€ä¸ªåŸºäºåŸç”Ÿ **Java Servlet + JSP** å®ç°çš„è½»é‡çº§åœ¨çº¿èŠå¤©å®¤ç³»ç»Ÿã€‚
è¯¥é¡¹ç›®ä¸ä¾èµ– Spring ç­‰é‡å‹æ¡†æ¶ï¼Œæ—¨åœ¨æ¼”ç¤º **B/S æ¶æ„** ä¸‹çš„ WebSocket æ›¿ä»£æ–¹æ¡ˆï¼ˆçŸ­è½®è¯¢ï¼‰ã€**Java EE/Jakarta EE** æ ¸å¿ƒç»„ä»¶ï¼ˆFilter, Listenerï¼‰çš„ç»¼åˆè¿ç”¨ä»¥åŠå‰åç«¯åˆ†ç¦»çš„æ•°æ®äº¤äº’æ¨¡å¼ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½ (Features)

*   **ğŸ‘¥ å¤šäººå³æ—¶ç¾¤èŠ**ï¼šæ‰€æœ‰åœ¨çº¿ç”¨æˆ·é»˜è®¤è¿›å…¥ç¾¤èŠå¤§å…ï¼Œæ¶ˆæ¯å®æ—¶åŒæ­¥ã€‚
*   **ğŸ”’ ä¸€å¯¹ä¸€ç§èŠ**ï¼šç‚¹å‡»ç”¨æˆ·å¤´åƒå³å¯åˆ‡æ¢è‡³ç§èŠé¢‘é“ï¼Œæ¶ˆæ¯å†…å®¹ä»…åŒæ–¹å¯è§ï¼Œå…·æœ‰ç‹¬ç«‹çš„æ¶ˆæ¯æµéš”ç¦»ã€‚
*   **ğŸŸ¢ å®æ—¶åœ¨çº¿åˆ—è¡¨**ï¼šåŠ¨æ€å±•ç¤ºå½“å‰åœ¨çº¿ç”¨æˆ·ï¼Œæ”¯æŒå®æ—¶åˆ·æ–°ã€‚
*   **ğŸ“¢ ç³»ç»Ÿå¹¿æ’­é€šçŸ¥**ï¼šåˆ©ç”¨ç›‘å¬å™¨è‡ªåŠ¨æ•è·ç”¨æˆ·ç™»å½•/é€€å‡ºï¼ˆåŒ…æ‹¬æ„å¤–æ–­çº¿ï¼‰äº‹ä»¶ï¼Œå¹¶å¹¿æ’­â€œåŠ å…¥/ç¦»å¼€â€æç¤ºã€‚
*   **ğŸ›¡ï¸ å®‰å…¨ä¸æƒé™**ï¼š
    *   **ç™»å½•æ‹¦æˆª**ï¼šæœªç™»å½•ç”¨æˆ·æ— æ³•è®¿é—®èŠå¤©é¡µé¢ã€‚
    *   **XSS é˜²å¾¡**ï¼šå‰ç«¯è‡ªåŠ¨è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œé˜²æ­¢è„šæœ¬æ³¨å…¥æ”»å‡»ã€‚
    *   **é˜²æ­¢é‡å¤ç™»å½•**ï¼šåŒä¸€è´¦å·åœ¨çº¿æ—¶ç¦æ­¢å†æ¬¡ç™»å½•ã€‚
*   **ğŸ’¾ å†…å­˜æ•°æ®å­˜å‚¨**ï¼šä½¿ç”¨ `ConcurrentHashMap` å’Œ `CopyOnWriteArrayList` åœ¨å†…å­˜ä¸­å­˜å‚¨ç”¨æˆ·å’Œæ¶ˆæ¯å†å²ï¼ˆæ— æ•°æ®åº“ä¾èµ–ï¼Œé‡å¯åé‡ç½®ï¼‰ã€‚

## ğŸ›  æŠ€æœ¯æ ˆ (Tech Stack)

### Backend (åç«¯)
*   **Core**: Java (Jakarta EE)
*   **Controller**: Servlet (`HttpServlet`)
*   **View**: JSP (JavaServer Pages)
*   **Components**:
    *   **Listener**: `HttpSessionListener` (ç›‘å¬ä¸Šä¸‹çº¿), `ServletContextListener` (åˆå§‹åŒ–èµ„æº)
    *   **Filter**: `EncodingFilter` (UTF-8ç¼–ç ), `AuthenticationFilter` (æƒé™æ§åˆ¶)
*   **Server**: Apache Tomcat 10+ (æ”¯æŒ `jakarta.*` åŒ…)

### Frontend (å‰ç«¯)
*   **Core**: Vanilla JavaScript (ES6+)
*   **Networking**: Fetch API (AJAX)
*   **Styling**: CSS3 Flexbox (å“åº”å¼å¸ƒå±€)
*   **Architecture**: SPA (å•é¡µåº”ç”¨) é£æ ¼çš„äº¤äº’ä½“éªŒ

## ğŸ“‚ é¡¹ç›®ç»“æ„ (Project Structure)

```
text
src/main
â”œâ”€â”€ java/com/example/chatapp
â”‚   â”œâ”€â”€ User.java                 # ç”¨æˆ·å®ä½“ç±»
â”‚   â”œâ”€â”€ Message.java              # æ¶ˆæ¯å®ä½“ç±» (æ”¯æŒç¾¤èŠ/ç§èŠ/ç³»ç»Ÿæ¶ˆæ¯)
â”‚   â”‚
â”‚   â”œâ”€â”€ LoginServlet.java         # å¤„ç†ç™»å½•é€»è¾‘
â”‚   â”œâ”€â”€ LogoutServlet.java        # å¤„ç†æ³¨é”€é€»è¾‘
â”‚   â”œâ”€â”€ MessageServlet.java       # æ ¸å¿ƒï¼šå¤„ç†æ¶ˆæ¯å‘é€ä¸æ‹‰å– (å«ç­›é€‰é€»è¾‘)
â”‚   â”œâ”€â”€ OnlineUsersServlet.java   # APIï¼šè¿”å›åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ JSON
â”‚   â”‚
â”‚   â”œâ”€â”€ SessionListener.java      # æ ¸å¿ƒï¼šè‡ªåŠ¨ç›‘å¬ Session é”€æ¯ä¸å±æ€§å˜åŒ–ï¼Œç”Ÿæˆç³»ç»Ÿé€šçŸ¥
â”‚   â”œâ”€â”€ ChatContextListener.java  # åˆå§‹åŒ–å…¨å±€å†…å­˜æ•°æ®ç»“æ„
â”‚   â”‚
â”‚   â”œâ”€â”€ AuthenticationFilter.java # ç™»å½•æƒé™æ‹¦æˆªå™¨
â”‚   â””â”€â”€ EncodingFilter.java       # å…¨å±€å­—ç¬¦é›†è¿‡æ»¤å™¨
â”‚
â””â”€â”€ webapp
    â”œâ”€â”€ css
    â”‚   â””â”€â”€ style.css             # èŠå¤©å®¤æ ·å¼è¡¨ (ä»¿å¾®ä¿¡/WhatsAppé£æ ¼)
    â”œâ”€â”€ chatroom.jsp              # èŠå¤©ä¸»é¡µé¢ (åŒ…å«æ ¸å¿ƒ JS é€»è¾‘)
    â”œâ”€â”€ login.jsp                 # ç™»å½•é¡µé¢
    â””â”€â”€ WEB-INF/web.xml           # éƒ¨ç½²æè¿°ç¬¦
```
# ğŸš€ æ ¸å¿ƒå®ç°åŸç† (Key Concepts)
1. æ¶ˆæ¯åŒæ­¥æœºåˆ¶ï¼šçŸ­è½®è¯¢ (Short Polling)
é¡¹ç›®æœªä½¿ç”¨ WebSocketï¼Œè€Œæ˜¯é‡‡ç”¨äº†æ›´åŸºç¡€çš„ AJAX çŸ­è½®è¯¢ æœºåˆ¶ã€‚
å‰ç«¯ï¼šä½¿ç”¨ setInterval æ¯éš” 1.5 ç§’å‘ MessageServlet å‘èµ·è¯·æ±‚ã€‚
åç«¯ï¼šMessageServlet æ ¹æ®å‰ç«¯ä¼ æ¥çš„ sinceIdï¼ˆæœ€åä¸€æ¡æ¶ˆæ¯IDï¼‰è¿”å›å¢é‡æ•°æ®ï¼Œæå¤§åœ°å‡å°‘äº†æ•°æ®ä¼ è¾“é‡ã€‚
2. ç¾¤èŠä¸ç§èŠçš„éš”ç¦»
æ•°æ®æ¨¡å‹ï¼šMessage å¯¹è±¡åŒ…å« receiver å­—æ®µã€‚
receiver == "all" æˆ– nullï¼šç¾¤èŠæ¶ˆæ¯ã€‚
receiver == "username"ï¼šç§èŠæ¶ˆæ¯ã€‚
åç«¯ç­›é€‰ï¼šå‰ç«¯è¯·æ±‚æ¶ˆæ¯æ—¶æºå¸¦ chatPartner å‚æ•°ã€‚åç«¯ Servlet ä¼šæ ¹æ®æ­¤å‚æ•°è¿‡æ»¤æ¶ˆæ¯åˆ—è¡¨ï¼Œç¡®ä¿ç”¨æˆ·åœ¨ç¾¤èŠæ¨¡å¼ä¸‹çœ‹ä¸åˆ°ç§èŠï¼Œç§èŠæ¨¡å¼ä¸‹çœ‹ä¸åˆ°ç¾¤èŠã€‚
3. è‡ªåŠ¨åŒ–çš„ä¸Šä¸‹çº¿é€šçŸ¥
åˆ©ç”¨ è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰ï¼š
ä¸Šçº¿ï¼šSessionListener ç›‘å¬ attributeAdded äº‹ä»¶ï¼Œä¸€æ—¦ Session ä¸­å­˜å…¥ usernameï¼Œè‡ªåŠ¨ç”Ÿæˆâ€œç³»ç»Ÿæ¶ˆæ¯â€ã€‚
ä¸‹çº¿ï¼šç›‘å¬ sessionDestroyed äº‹ä»¶ã€‚æ— è®ºæ˜¯ç”¨æˆ·ç‚¹å‡»â€œé€€å‡ºâ€è¿˜æ˜¯ç›´æ¥å…³é—­æµè§ˆå™¨å¯¼è‡´ Session è¶…æ—¶ï¼Œç›‘å¬å™¨éƒ½ä¼šè§¦å‘ï¼Œå°†ç”¨æˆ·ä»åœ¨çº¿åˆ—è¡¨ç§»é™¤å¹¶ç”Ÿæˆâ€œç³»ç»Ÿæ¶ˆæ¯â€ã€‚
# âš™ï¸ å¿«é€Ÿå¼€å§‹ (Getting Started)
å‰ç½®æ¡ä»¶
JDK 11 æˆ–æ›´é«˜ç‰ˆæœ¬
Apache Maven
Apache Tomcat 10.0+ (æ³¨æ„ï¼šç”±äºä»£ç ä½¿ç”¨äº† jakarta.servletï¼Œå¿…é¡»ä½¿ç”¨ Tomcat 10 æˆ–æ›´é«˜ç‰ˆæœ¬)
éƒ¨ç½²æ­¥éª¤
å…‹éš†é¡¹ç›®ï¼š
code
Bash
git clone https://github.com/yourusername/java-web-chat.git
æ„å»º WAR åŒ…ï¼š
åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ Maven å‘½ä»¤ï¼š
code
Bash
mvn clean package
éƒ¨ç½²ï¼š
å°†ç”Ÿæˆçš„ target/your-app.war å¤åˆ¶åˆ° Tomcat çš„ webapps ç›®å½•ä¸‹ã€‚
è¿è¡Œï¼š
å¯åŠ¨ Tomcatï¼Œè®¿é—®ï¼š
code
Text
http://localhost:8080/your-app/login.jsp
æµ‹è¯•è´¦å·
é¡¹ç›®å†…ç½®äº†ä»¥ä¸‹æµ‹è¯•è´¦å·ï¼ˆå¯†ç å‡ä¸ºä»»æ„å­—ç¬¦ï¼Œæˆ–ä»£ç ä¸­é¢„è®¾çš„ï¼‰ï¼š
admin
user1
user2
user3
# ğŸ“ License
This project is open-source and available under the MIT License.